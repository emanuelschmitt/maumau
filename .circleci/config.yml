version: 2.1
jobs:
  build_and_test:
    docker:
      - image: circleci/node:12.18.2
    steps:
      - checkout
      - run: yarn install
      - run: yarn lint
      - run: yarn build
      - run: yarn test
  deploy:
    machine: true
    environment:
      HEROKU_APP_NAME: 'maumau-io' # define env var $HEROKU_APP
    steps:
      - checkout
      - heroku/check-authentication
      - setup_remote_docker
      - heroku/push-docker-image:
          app-name: $HEROKU_APP_NAME
          process-types: web
      - heroku/release-docker-image:
          app-name: $HEROKU_APP_NAME
          process-types: web
workflows:
  version: 2
  build_test_deploy:
    jobs:
      - build_and_test
      - deploy
orbs:
  heroku: circleci/heroku@1.2.2
